name: ğŸ¬ Auto Combine Live TV Playlists

on:
  schedule:
    - cron: "*/30 * * * *"   # â° à¦ªà§à¦°à¦¤à¦¿ à§©à§¦ à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦ªà¦° à¦°à¦¾à¦¨ à¦•à¦°à¦¬à§‡
  workflow_dispatch:          # ğŸ§‘â€ğŸ’» à¦šà¦¾à¦‡à¦²à§‡ à¦®à§à¦¯à¦¾à¦¨à§à§Ÿà¦¾à¦²à¦¿ à¦šà¦¾à¦²à¦¾à¦¨à§‹ à¦¯à¦¾à¦¬à§‡

permissions:
  contents: write

jobs:
  combine:
    runs-on: ubuntu-latest

    steps:
      # ğŸ§© Step 1: Checkout Repository
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      # ğŸ§© Step 2: Setup Python
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # ğŸ§© Step 3: Install Dependencies
      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install --upgrade pip

      # ğŸ§© Step 4: Run the Python Script
      # âš ï¸ à¦¯à¦¦à¦¿ à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿà¦Ÿà¦¿ "Script/" à¦«à§‹à¦²à§à¦¡à¦¾à¦°à§‡ à¦¥à¦¾à¦•à§‡, à¦¨à¦¿à¦šà§‡à¦° à¦²à¦¾à¦‡à¦¨à§‡ à¦¸à§‡à¦‡ path à¦°à¦¾à¦–à§‹
      - name: ğŸ§  Run Combine Script
        run: |
          if [ -f "Script/combine_live_tv.py" ]; then
            python Script/combine_live_tv.py
          elif [ -f "combine_live_tv.py" ]; then
            python combine_live_tv.py
          else
            echo "âŒ Script not found!"
            exit 1
          fi

      # ğŸ§© Step 5: Check for Output Changes
      - name: ğŸ” Check if Files Changed
        id: changes
        run: |
          git add Combined_Live_TV.m3u Duplicate.m3u
          if [ -z "$(git diff --staged --name-only)" ]; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      # ğŸ§© Step 6: Commit & Push Only If Changed
      - name: ğŸ’¾ Commit & Push Changes
        if: steps.changes.outputs.changed == 'true'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "actions@github.com"
          git commit -m "ğŸ” Auto-update Combined_Live_TV.m3u & Duplicate.m3u [$(date +'%Y-%m-%d %H:%M:%S')]"
          git push "https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git" HEAD:${{ github.ref }}

      # ğŸ§© Step 7: Log if Nothing Changed
      - name: âœ… No Changes Found
        if: steps.changes.outputs.changed == 'false'
        run: echo "âœ… No changes detected. Skipping commit."
