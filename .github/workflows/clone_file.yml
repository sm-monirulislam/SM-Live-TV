name: ЁЯФБ Sync Combined_Live_TV.m3u to Public Repo

on:
  schedule:
    - cron: "*/20 * * * *"  # ржкрзНрж░рждрж┐ рзирзж ржорж┐ржирж┐ржЯ ржкрж░ржкрж░ ржЕржЯрзЛ рж░рж╛ржи рж╣ржмрзЗ
  workflow_dispatch:  # ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржЕржкрж╢ржи

jobs:
  sync-file:
    runs-on: ubuntu-latest
    
    steps:
      - name: ЁЯФД ржкрзНрж░рж╛ржЗржнрзЗржЯ рж░рзЗржкрзЛ ржЪрзЗржХржЖржЙржЯ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # рж╕ржорзНржкрзВрж░рзНржг рж╣рж┐рж╕рзНржЯрзЛрж░рж┐ ржлрзЗржЪ ржХрж░ржмрзЗ
          
      - name: тЪЩя╕П Git ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржХржиржлрж┐ржЧрж╛рж░
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"
          
      - name: ЁЯУе ржкрж╛ржмрж▓рж┐ржХ рж░рзЗржкрзЛ ржХрзНрж▓рзЛржи
        run: |
          git clone https://x-access-token:${{ secrets.PUBLIC_REPO_TOKEN }}@github.com/sm-monirulislam/SM-LiveTV-Auto-Update.git public_repo
          
      - name: ЁЯУБ рж╕рзНржкрзЗрж╕рж┐ржлрж┐ржХ ржлрж╛ржЗрж▓ ржХржкрж┐
        run: |
          # ржлрж╛ржЗрж▓ ржПржХрзНрж╕рж┐рж╕рзНржЯ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рж╛
          if [ -f "Combined_Live_TV.m3u" ]; then
            cp Combined_Live_TV.m3u public_repo/
            echo "тЬЕ ржлрж╛ржЗрж▓ рж╕ржлрж▓ржнрж╛ржмрзЗ ржХржкрж┐ рж╣рзЯрзЗржЫрзЗ"
          else
            echo "тЭМ Combined_Live_TV.m3u ржлрж╛ржЗрж▓ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐"
            exit 1
          fi
          
      - name: ЁЯЪА ржкрж╛ржмрж▓рж┐ржХ рж░рзЗржкрзЛрждрзЗ ржкрзБрж╢
        run: |
          cd public_repo
          
          # ржлрж╛ржЗрж▓ржЯрж┐рж░ ржкрж░рж┐ржмрж░рзНрждржи ржЪрзЗржХ ржХрж░рж╛
          if git diff --quiet Combined_Live_TV.m3u; then
            echo "тД╣я╕П ржХрзЛржирзЛ ржкрж░рж┐ржмрж░рзНрждржи ржирзЗржЗ, ржкрзБрж╢ ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ"
          else
            git add Combined_Live_TV.m3u
            git commit -m "ЁЯдЦ ржЕржЯрзЛ ржЖржкржбрзЗржЯ: Combined_Live_TV.m3u - $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "тЬЕ ржлрж╛ржЗрж▓ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ рж╣рзЯрзЗржЫрзЗ"
          fi
        
      - name: ЁЯз╣ ржЯрзЗржорзНржкрзЛрж░рж╛рж░рж┐ ржлрж╛ржЗрж▓ ржХрзНрж▓рж┐ржиржЖржк
        run: |
          rm -rf public_repo
          echo "ЁЯз╣ ржХрзНрж▓рж┐ржиржЖржк рж╕ржорзНржкржирзНржи"
