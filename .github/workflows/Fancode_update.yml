name: ğŸ” Auto Update Fancode M3U Playlist

on:
  schedule:
    - cron: "*/10 * * * *"   # â° à¦ªà§à¦°à¦¤à¦¿ à§§à§¦ à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦°à¦¾à¦¨ à¦•à¦°à¦¬à§‡
  workflow_dispatch:         # ğŸ§‘â€ğŸ’» à¦®à§à¦¯à¦¾à¦¨à§à§Ÿà¦¾à¦²à¦¿ à¦šà¦¾à¦²à¦¾à¦¨à§‹ à¦¯à¦¾à¦¬à§‡

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: ğŸ“¥ Install Dependencies
        run: pip install requests

      - name: ğŸ¬ Run Update Script
        run: python Script/Fancode_playlist.py   # âœ… à¦¨à¦¤à§à¦¨ à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦¨à¦¾à¦®

      - name: ğŸ’¾ Commit and Push Updated Playlist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          if [ -f Fancode.m3u ]; then
            git add Fancode.m3u
            git commit -m "ğŸ” Auto update Fancode.m3u [$(date '+%Y-%m-%d %H:%M:%S')]" || echo "No changes"
            git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }} HEAD:${{ github.ref }}
          else
            echo "âŒ Fancode.m3u file not found"
          fi
